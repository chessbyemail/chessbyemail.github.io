(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4186)}])},4186:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return f}});var s=t(5893),a=t(7294),n=t(4089),r=t(1163),i=t(1752),o=t.n(i);let{publicRuntimeConfig:c}=o()(),d="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function f(){let e=(0,r.useRouter)(),{state:l}=e.query,t=(0,a.useMemo)(()=>{let e=[],t=l||[];for(let s=0;s<t.length;s+=2){let a=u.indexOf(t[s+0]),n=u.indexOf(t[s+1]);e.push([a,n])}return e},[l]),[i,o]=(0,a.useState)(!1),[f,w]=(0,a.useState)(!1),[b,v]=(0,a.useState)(!1),[k,C]=(0,a.useState)(null),[M,A]=(0,a.useState)(null),_=(0,a.useMemo)(()=>p(d).board,[d]),[D,E]=(0,a.useState)(null),{board:P,check:S,mate:O,lostPieces:q}=(0,a.useMemo)(()=>{let e=[..._],l=[],s=null;for(let[a,n]of t)e[n]&&l.push(e[n]),e[n]=e[a],e[a]=0,s=n;if(Array.isArray(D)){let[r,i]=D;e[i]&&l.push(e[i]),e[i]=e[r],e[r]=0,s=i}let o=null!==s&&g(e,s).map(l=>e[l]).includes(e[s]>=8?6:14),c=!1;if(o){let d=e.map((e,l)=>l).filter(l=>null!==s&&e[s]>=8?e[l]<8:e[l]>=8);for(let u of(c=!0,d)){let{possibleMoves:f}=N(e,u);if(f.length>0){c=!1;break}}}return{board:e,lostPieces:l,check:o,mate:c}},[d,t,D]),B=t.length%2!=0,R=(0,a.useMemo)(()=>{if(null===D)return null;let e=t.concat([D||[]]).flat().map(e=>u[e]).join("");return"".concat(window.location.origin,"/?state=").concat(e)},[t,D,S]),{x0:K,y0:T,dx:F,dy:H}=(0,a.useMemo)(()=>{if(!Array.isArray(D))return{};{let e=j(D[0],B),l=j(D[1],B),t=1+2*e[1],s=1+2*e[0],a=1+2*l[1],n=1+2*l[0],r=a-t,i=n-s,o=Math.sqrt(r*r+i*i);return{x0:t,y0:s,dx:r/o*(o-.71),dy:i/o*(o-.71)}}},[D]),[Q,W]=(0,a.useState)(!1),G=(0,a.useRef)(null),{possibleMoves:X,forbiddenMoves:I}=(0,a.useMemo)(()=>N(P,k),[P,k]);return(0,a.useEffect)(()=>void console.log({forbiddenMoves:I}),[I]),(0,s.jsxs)("div",{className:"w-full min-h-full flex flex-col items-center justify-center gap-4 md:py-4 font-sans",children:[(0,s.jsxs)("h1",{className:"text-3xl font-black text-black dark:text-slate-300",children:["chess",(0,s.jsx)("span",{className:"text-slate-400 dark:text-slate-500",children:"by"}),"email",(0,s.jsx)("span",{className:"text-2xl",children:".com"})]}),(0,s.jsxs)("div",{className:"flex flex-col w-full md:w-auto gap-2",children:[(0,s.jsx)(h,{outerClassName:"w-full pb-1/8",innerClassName:"flex flex-row justify-start -space-x-4",children:q.filter(e=>B?e<8:e>=8).map((e,l)=>(0,s.jsx)(m,{className:"",piece:e},l))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-col gap-0",children:[(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-slate-500 font-bold",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"w-16 text-center rotate-180",children:"ABCDEFGH"[B?7-l:l]},l))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-row gap-0",children:[(0,s.jsx)("div",{className:"md:flex hidden flex-col h-full justify-center items-center w-6 text-slate-500 font-bold py-2",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"h-16 flex items-center",children:B?1+l:8-l},l))}),(0,s.jsx)("div",{className:"w-full md:w-auto border-slate-300 md:border-8 border-double border-y-8 box-content",children:(0,s.jsx)(h,{outerClassName:"md:w-128 w-full pb-full",children:(0,s.jsx)("div",{className:"flex flex-row md:h-auto md:w-auto h-full w-full",children:(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)("div",{className:"flex flex-col md:h-auto h-full",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"md:h-16 h-1/8 flex flex-row",children:Array(8).fill(0).map((e,t)=>[l^(B?7:0),t^(B?7:0),8*l+t^(B?63:0)]).map(e=>{let[l,a,r]=e;return(0,s.jsxs)("button",{disabled:!(null===k&&null===D&&0!==P[r]&&(B?P[r]>=8:P[r]<8)||null!==k&&null===D&&X.includes(r)||null!==k&&0!==P[r]&&(B?P[r]>=8:P[r]<8)||null===k&&null!==D&&r===D[0]),className:(0,n.twCascade)("h-full md:w-16 w-1/8 relative",{"bg-white dark:bg-slate-300":(l+a&1)==0,"bg-slate-300 dark:bg-slate-400":(l+a&1)==1}),onClick(e){if(null===D){v(!0);let l=P[r];k===r?C(null):0!=l&&(l>=8&&B||l<8&&!B)?C(r):null!==k&&X.includes(r)&&(w(!1),E([k,r]),C(null))}else r===D[0]&&(E(null),C(r))},onMouseOver:()=>void A(r),onMouseOut:()=>void A(null),children:[0!==P[r]&&(0,s.jsx)(x,{className:"h-full w-full",piece:P[r]}),X.includes(r)&&(0,s.jsx)("div",{className:"absolute h-[87.5%] w-[87.5%] border-dotted border-4 border-slate-500 dark:border-slate-800 rounded-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"},r),I.includes(r)&&(0,s.jsx)("div",{className:"absolute pointer-events-none -translate-x-1/2 -translate-y-1/2 text-4xl leading-none top-1/2 left-1/2",children:"\uD83D\uDFAC"}),(k===r||!b&&null===k&&null===D&&t.length>0&&t[t.length-1].includes(r)||(null==D?void 0:D.includes(r)))&&(0,s.jsx)("div",{className:"absolute pointer-events-none inset-0 border-solid md:border-4 border-[3px] border-slate-600 dark:border-slate-800"})]},a)})},l))}),S&&(0,s.jsx)("svg",{viewBox:"0 0 400 100",xmlns:"http://www.w3.org/2000/svg",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 md:h-32 h-28 pointer-events-none",children:(0,s.jsx)("text",{className:(0,n.twCascade)("text-4xl stroke-black fill-white font-serif font-black",{"fill-black stroke-white":t.length%2==(null===D?0:1)}),x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",strokeWidth:"3",paintOrder:"stroke",children:O?"CHECKMATE":"CHECK"})}),0===t.length&&!i&&(0,s.jsxs)(y,{onClose:()=>void o(!0),children:[(0,s.jsxs)("p",{children:["Welcome to ",(0,s.jsx)("i",{children:"chessbyemail"}),", a web app for playing correspondance chess."]}),(0,s.jsx)("p",{children:"When you've made your first move, a link is generated. You send this link to your opponent who continues the game."}),(0,s.jsx)("p",{children:"The state of the game is not stored on this server, it is encoded in the links you send when playing."}),(0,s.jsx)("div",{className:"self-center",children:(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void o(!0),children:"Start"})})]}),R&&!f&&(0,s.jsxs)(y,{className:"items-center",onClose:()=>void w(!0),children:[(0,s.jsx)("p",{className:"text-center",children:"Send the following link to your opponent"}),(0,s.jsx)("div",{className:"flex flex-row gap-4",children:(0,s.jsx)("input",{ref:G,style:{all:"revert"},type:"text",value:R,readOnly:!0,onFocus:e=>void e.target.select()})}),window.navigator&&(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[window.navigator.clipboard&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void window.navigator.clipboard.writeText(R),children:"Copy to clipboard"}),window.navigator.share&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void window.navigator.share({title:"chessbyemail.com",url:R}).then(()=>{}).catch(e=>void console.error(e)),children:"Share"})]})]})]})})})}),(0,s.jsx)("div",{className:"hidden md:flex flex-col h-full justify-center items-center w-6 text-slate-500 font-bold py-2",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"h-16 flex items-center rotate-180",children:B?1+l:8-l},l))})]}),(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-slate-500 font-bold",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"w-16 text-center",children:"ABCDEFGH"[B?7-l:l]},l))})]}),(0,s.jsx)(h,{outerClassName:"w-full pb-1/8",innerClassName:"flex flex-row justify-start -space-x-4",children:q.filter(e=>B?e>=8:e<8).map((e,l)=>(0,s.jsx)(m,{className:"",piece:e},l))})]}),(0,s.jsxs)("div",{className:"flex flex-row gap-6 text-xs opacity-50",children:[(0,s.jsx)("p",{children:"Copyright 2022, D. Revelj"}),(0,s.jsxs)("p",{children:["Version ",null==c?void 0:c.version]}),(0,s.jsx)("a",{className:"hover:underline",href:"https://github.com/chessbyemail/chessbyemail.github.io/issues",children:"Report an issue"})]})]})}function h(e){let{children:l,innerClassName:t,outerClassName:a}=e;return(0,s.jsx)("div",{className:(0,n.twCascade)("h-0 relative",a),children:(0,s.jsx)("div",{className:(0,n.twCascade)("absolute inset-0",t),children:l})})}function x(e){let{className:l,piece:t}=e;return(0,s.jsxs)("div",{className:(0,n.twCascade)("relative md:text-6xl text-5xl w-full h-full font-serif",l),title:v.get(t),children:[(0,s.jsx)("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white h-full w-full",children:(t>=8?w:b).get(7&t)}),(0,s.jsx)("span",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-full text-black",children:(t<8?w:b).get(7&t)})]})}function m(e){let{className:l,piece:t}=e;return(0,s.jsx)("div",{className:(0,n.twCascade)("md:text-6xl text-5xl",l),children:(t<8?w:b).get(7&t)})}let p=e=>{let l=new Map([["p",9],["n",10],["b",11],["r",12],["q",13],["k",14],["P",1],["N",2],["B",3],["R",4],["Q",5],["K",6]]),t=[];for(let s of e)t.length<64&&(l.has(s)?t.push(l.get(s)):/^[0-9]$/.test(s)&&t.push(...Array(parseInt(s)).fill(0)));return{board:t}},w=new Map([[0," "],[1,"♙"],[2,"♘"],[3,"♗"],[4,"♖"],[5,"♕"],[6,"♔"]]),b=new Map([[0," "],[1,"♟"],[2,"♞"],[3,"♝"],[4,"♜"],[5,"♛"],[6,"♚"]]),v=new Map([[0,""],[1,"white pawn"],[2,"white knight"],[3,"white bishop"],[4,"white rook"],[5,"white queen"],[6,"white king"],[9,"black pawn"],[10,"black knight"],[11,"black bishop"],[12,"black rook"],[13,"black queen"],[14,"black king"]]);function j(e,l){let t=Math.floor(e/8),s=e%8;return l&&(t=7-t,s=7-s),[t,s]}function N(e,l){if(null===l||0===e[l])return{forbiddenMoves:[],possibleMoves:[]};let t=g(e,l),s=e[l]>=8,a=e.map((e,l)=>[e,l]).filter(e=>{let[l,t]=e;return l&&(s?l<8:l>=8)}),n=[];for(let r of t){let i=[...e];i[r]=i[l],i[l]=0;let o=i.indexOf((s?8:0)+6);for(let[c,d]of a){let u=g(i,d);u.includes(o)&&n.push(r)}}return{forbiddenMoves:n,possibleMoves:t.filter(e=>!n.includes(e))}}function g(e,l){if(null===l)return[];let t=[],[s,a]=[Math.floor(l/8),l%8],n=e[l],r=n>=8?1:-1;switch(7&n){case 1:0===e[(s+r)*8+a]&&t.push([s+r,a]),e[(s+r)*8+a-1]&&t.push([s+r,a-1]),e[(s+r)*8+a+1]&&t.push([s+r,a+1]),(n<8&&6===s||n>=8&&1===s)&&0===e[(s+2*r)*8+a]&&t.push([s+2*r,a]);break;case 2:t.push(...[[-2,-1],[-2,1],[2,-1],[2,1],[-1,2],[1,2],[-1,-2],[-1,2]].map(e=>{let[l,t]=e;return[s+l,a+t]}));break;case 3:for(let[i,o]of[[-1,-1],[1,1],[1,-1],[-1,1]])for(let[c,d]=[s+i,a+o];c>=0&&c<8&&d>=0&&d<8&&(t.push([c,d]),!e[8*c+d]);c+=i,d+=o);break;case 4:for(let[u,f]of[[-1,0],[1,0],[0,-1],[0,1]])for(let[h,x]=[s+u,a+f];h>=0&&h<8&&x>=0&&x<8&&(t.push([h,x]),!e[8*h+x]);h+=u,x+=f);break;case 5:for(let[m,p]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,1],[1,-1],[-1,1]])for(let[w,b]=[s+m,a+p];w>=0&&w<8&&b>=0&&b<8&&(t.push([w,b]),!e[8*w+b]);w+=m,b+=p);break;case 6:t.push(...[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(e=>{let[l,t]=e;return[s+l,a+t]}))}return t.filter(l=>{let[t,s]=l;return t>=0&&t<8&&s>=0&&s<8&&(0===e[8*t+s]||n<8&&e[8*t+s]>=8||n>=8&&e[8*t+s]<8)}).map(e=>{let[l,t]=e;return 8*l+t})}function y(e){let{children:l,className:t,onClose:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.twCascade)("absolute inset-0 bg-black bg-opacity-50","flex flex-col items-center justify-center"),children:(0,s.jsxs)("div",{className:(0,n.twCascade)("relative rounded-md bg-slate-100 text-black w-10/12 p-6","flex flex-col gap-4 items-start",t),children:[l,a&&(0,s.jsx)("button",{className:"absolute top-1 right-2",onClick:a,children:"\uD83D\uDDD9"})]})})}}},function(e){e.O(0,[387,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);