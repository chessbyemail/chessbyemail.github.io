(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(9262)}])},9262:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return x}});var s=t(5893),a=t(5675),r=t.n(a),i=t(7294),n=t(4089),o=t(1163),d=t(1752),c=t.n(d);let{publicRuntimeConfig:h}=c()(),u="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function x(){let e=(0,o.useRouter)(),{state:l}=e.query,t=(0,i.useMemo)(()=>{let e=[],t=l||[];for(let s=0;s<t.length;s+=2){let a=f.indexOf(t[s+0]),r=f.indexOf(t[s+1]);e.push([a,r])}return e},[l]),[a,r]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[x,v]=(0,i.useState)(!1),[y,C]=(0,i.useState)(null),[_,M]=(0,i.useState)(null),q=(0,i.useMemo)(()=>w(u).board,[u]),[A,P]=(0,i.useState)(null),{board:E,check:S,mate:K,lostPieces:O,castling:B}=(0,i.useMemo)(()=>{let e=[...q],l=[],s={K:!0,Q:!0,k:!0,q:!0},a=null;for(let[r,i]of t.concat(A?[A]:[]))(7&e[r])==6&&(7&r)==4&&((7&i)==1?(e[(56&i)+2]=e[(56&i)+0],e[(56&i)+0]=0):(7&i)==6&&(e[(56&i)+5]=e[(56&i)+7],e[(56&i)+7]=0)),e[i]&&l.push(e[i]),e[i]=e[r],e[r]=0,(7&e[i])==1&&(i<8?e[i]=5:i>=56&&(e[i]=13)),0===r?s.q=!1:4===r?(s.q=!1,s.k=!1):7===r?s.k=!1:56===r?s.Q=!1:60===r?(s.Q=!1,s.K=!1):63===r&&(s.K=!1),a=i;let n=null!==a&&k(e,a,s).map(l=>e[l]).includes(e[a]>=8?6:14),o=!1;if(n){let d=e.map((e,l)=>l).filter(l=>null!==a&&e[a]>=8?e[l]<8:e[l]>=8);for(let c of(o=!0,d)){let{possibleMoves:h}=j(e,c,s);if(h.length>0){o=!1;break}}}return{board:e,lostPieces:l,check:n,mate:o,castling:s}},[u,t,A]),Q=t.length%2!=0,R=(0,i.useMemo)(()=>{if(null===A)return null;let e=t.concat([A||[]]).flat().map(e=>f[e]).join("");return"".concat(window.location.origin,"/?state=").concat(e)},[t,A,S]),{x0:T,y0:F,dx:H,dy:D}=(0,i.useMemo)(()=>{if(!Array.isArray(A))return{};{let e=g(A[0],Q),l=g(A[1],Q),t=1+2*e[1],s=1+2*e[0],a=1+2*l[1],r=1+2*l[0],i=a-t,n=r-s,o=Math.sqrt(i*i+n*n);return{x0:t,y0:s,dx:i/o*(o-.71),dy:n/o*(o-.71)}}},[A]),[W,G]=(0,i.useState)(!1),X=(0,i.useRef)(null),{possibleMoves:I,forbiddenMoves:V}=(0,i.useMemo)(()=>j(E,y,B),[E,y,B]);return(0,s.jsxs)("div",{className:"w-full min-h-full flex flex-col items-center justify-between gap-4 md:py-4 max-w-xl mx-auto",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("h1",{className:"text-3xl font-black text-black dark:text-slate-300",children:["chess",(0,s.jsx)("span",{className:"text-slate-400 dark:text-slate-500",children:"by"}),"email",(0,s.jsx)("span",{className:"text-2xl",children:".com"})]}),(0,s.jsxs)("div",{className:"flex flex-col w-full md:w-auto gap-1 md:gap-0",children:[(0,s.jsx)(m,{outerClassName:"md:px-8 w-full",aspect:"6.25%",innerClassName:"flex flex-row",children:O.filter(e=>Q?e<8:e>=8).map((e,l)=>(0,s.jsx)(b,{className:"",piece:e},l))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-col gap-0",children:[(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-slate-500 font-bold",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"w-16 text-center rotate-180",children:"ABCDEFGH"[Q?7-l:l]},l))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-row gap-0",children:[(0,s.jsx)("div",{className:"md:flex hidden flex-col h-full justify-center items-center w-6 text-slate-500 font-bold py-2",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"h-16 flex items-center",children:Q?1+l:8-l},l))}),(0,s.jsx)("div",{className:"w-full md:w-auto border-slate-300 md:border-8 border-double border-y-8 box-content",children:(0,s.jsx)(m,{outerClassName:"md:w-128 w-full",aspect:"100%",children:(0,s.jsx)("div",{className:"flex flex-row md:h-auto md:w-auto h-full w-full",children:(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)("div",{className:"flex flex-col md:h-auto h-full",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"md:h-16 h-1/8 flex flex-row",children:Array(8).fill(0).map((e,t)=>[l^(Q?7:0),t^(Q?7:0),8*l+t^(Q?63:0)]).map(e=>{let[l,a,r]=e;return(0,s.jsxs)("button",{disabled:!(null===y&&null===A&&0!==E[r]&&(Q?E[r]>=8:E[r]<8)||null!==y&&null===A&&I.includes(r)||null!==y&&0!==E[r]&&(Q?E[r]>=8:E[r]<8)||null===y&&null!==A&&r===A[0]),className:(0,n.twCascade)("h-full md:w-16 w-1/8 relative",{"bg-white dark:bg-slate-300":(l+a&1)==0,"bg-slate-300 dark:bg-slate-400":(l+a&1)==1}),onClick(e){if(null===A){v(!0);let l=E[r];y===r?C(null):0!=l&&(l>=8&&Q||l<8&&!Q)?C(r):null!==y&&I.includes(r)&&(c(!1),P([y,r]),C(null))}else r===A[0]&&(P(null),C(r))},onMouseOver:()=>void M(r),onMouseOut:()=>void M(null),children:[0!==E[r]&&(0,s.jsx)(p,{className:"h-full w-full",piece:E[r]}),I.includes(r)&&(0,s.jsx)("div",{className:"absolute h-[87.5%] w-[87.5%] border-dotted border-4 border-slate-500 dark:border-slate-800 rounded-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"},r),V.includes(r)&&(0,s.jsxs)("div",{className:"w-full h-full relative",title:"This move would leave your king in check.",children:[(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-dotted border-slate-500 dark:border-slate-800 border-t-4 -rotate-45"}),(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-dotted border-slate-500 dark:border-slate-800 border-t-4 rotate-45"})]}),(y===r||!x&&null===y&&null===A&&t.length>0&&t[t.length-1].includes(r)||(null==A?void 0:A.includes(r)))&&(0,s.jsx)("div",{className:"absolute pointer-events-none inset-0 border-solid md:border-4 border-[3px] border-slate-600 dark:border-slate-800"})]},a)})},l))}),S&&(0,s.jsx)("svg",{viewBox:"0 0 400 100",xmlns:"http://www.w3.org/2000/svg",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 md:h-32 h-28 pointer-events-none",children:(0,s.jsx)("text",{className:(0,n.twCascade)("text-4xl stroke-black fill-white font-black font-serif",{"fill-black stroke-white":t.length%2==(null===A?0:1)}),x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",strokeWidth:"3",paintOrder:"stroke",children:K?"CHECKMATE":"CHECK"})}),0===t.length&&!a&&(0,s.jsxs)(N,{onClose:()=>void r(!0),children:[(0,s.jsxs)("p",{children:["Welcome to ",(0,s.jsx)("i",{children:"chessbyemail"}),", a web app for playing correspondance chess."]}),(0,s.jsx)("p",{children:"When you've made your first move, a link is generated. You send this link to your opponent who continues the game."}),(0,s.jsx)("p",{children:"The state of the game is not stored on this server, it is encoded in the links you send when playing."}),(0,s.jsx)("div",{className:"self-center",children:(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void r(!0),children:"Start"})})]}),R&&!d&&(0,s.jsxs)(N,{className:"items-center",onClose:()=>void c(!0),children:[S&&(0,s.jsx)("h1",{className:"text-lg font-bold",children:K?"Checkmate!":"Check!"}),(0,s.jsx)("p",{className:"text-center",children:"Send the following link to your opponent"}),(0,s.jsx)("div",{className:"flex flex-row gap-4",children:(0,s.jsx)("input",{ref:X,style:{all:"revert"},type:"text",value:R,readOnly:!0,onFocus:e=>void e.target.select()})}),navigator&&(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[navigator.clipboard&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void navigator.clipboard.writeText(R),children:"Copy to clipboard"}),navigator.share&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void navigator.share({title:"chessbyemail.com",url:R}).then(()=>{}).catch(e=>void console.error(e)),children:"Share"})]})]})]})})})}),(0,s.jsx)("div",{className:"hidden md:flex flex-col h-full justify-center items-center w-6 text-slate-500 font-bold py-2",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"h-16 flex items-center rotate-180",children:Q?1+l:8-l},l))})]}),(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-slate-500 font-bold",children:Array(8).fill(0).map((e,l)=>(0,s.jsx)("div",{className:"w-16 text-center",children:"ABCDEFGH"[Q?7-l:l]},l))})]}),(0,s.jsx)(m,{outerClassName:"md:px-8 w-full",aspect:"6.25%",innerClassName:"flex flex-row",children:O.filter(e=>Q?e>=8:e<8).map((e,l)=>(0,s.jsx)(b,{className:"",piece:e},l))})]}),(0,s.jsxs)("div",{className:"flex flex-row w-full justify-between text-xs opacity-50 max-w-[528px] md:px-0 px-1",children:[(0,s.jsx)("p",{children:"Copyright 2022, D. Revelj"}),(0,s.jsxs)("p",{children:["Version ",null==h?void 0:h.version]}),(0,s.jsx)("a",{className:"hover:underline",href:"https://github.com/chessbyemail/chessbyemail.github.io/issues",children:"Report an issue"})]})]})}function m(e){let{children:l,innerClassName:t,outerClassName:a,aspect:r}=e;return(0,s.jsx)("div",{className:(0,n.twCascade)("",a),children:(0,s.jsx)("div",{className:"h-0 relative w-full",style:{paddingBottom:r},children:(0,s.jsx)("div",{className:(0,n.twCascade)("absolute inset-0",t),children:l})})})}function p(e){let{className:l,piece:t}=e;return y.has(15&t)?(0,s.jsx)("div",{className:(0,n.twCascade)("relative w-full h-full",l),title:v.get(t),children:(0,s.jsx)(r(),{src:y.get(15&t),alt:v.get(t)||"",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-full"})}):(0,s.jsx)(s.Fragment,{})}function b(e){let{className:l,piece:t}=e;return(0,s.jsx)(m,{outerClassName:"w-1/16",aspect:"100%",children:(0,s.jsx)(r(),{src:y.get(15&t),alt:v.get(t)||"",className:"h-full",title:v.get(t)||""})})}let w=e=>{let l=new Map([["p",9],["n",10],["b",11],["r",12],["q",13],["k",14],["P",1],["N",2],["B",3],["R",4],["Q",5],["K",6]]),t=[];for(let s of e)t.length<64&&(l.has(s)?t.push(l.get(s)):/^[0-9]$/.test(s)&&t.push(...Array(parseInt(s)).fill(0)));return{board:t}},v=new Map([[0,""],[1,"white pawn"],[2,"white knight"],[3,"white bishop"],[4,"white rook"],[5,"white queen"],[6,"white king"],[9,"black pawn"],[10,"black knight"],[11,"black bishop"],[12,"black rook"],[13,"black queen"],[14,"black king"]]);function g(e,l){let t=Math.floor(e/8),s=e%8;return l&&(t=7-t,s=7-s),[t,s]}function j(e,l,t){if(null===l||0===e[l])return{forbiddenMoves:[],possibleMoves:[]};let s=k(e,l,t),a=e[l]>=8,r=e.map((e,l)=>[e,l]).filter(e=>{let[l,t]=e;return l&&(a?l<8:l>=8)}),i=[];for(let n of s){let o=[...e];o[n]=o[l],o[l]=0;let d=o.indexOf((a?8:0)+6);for(let[c,h]of r){let u=k(o,h,t);u.includes(d)&&i.push(n)}}return{forbiddenMoves:i,possibleMoves:s.filter(e=>!i.includes(e))}}function k(e,l,t){if(null===l)return[];let s=[],[a,r]=[Math.floor(l/8),l%8],i=e[l],n=i>=8?1:-1;switch(7&i){case 1:0===e[(a+n)*8+r]&&(s.push([a+n,r]),(i<8&&6===a||i>=8&&1===a)&&0===e[(a+2*n)*8+r]&&s.push([a+2*n,r])),e[(a+n)*8+r-1]&&s.push([a+n,r-1]),e[(a+n)*8+r+1]&&s.push([a+n,r+1]);break;case 2:s.push(...[[-2,-1],[-2,1],[2,-1],[2,1],[-1,2],[1,2],[-1,-2],[-1,2]].map(e=>{let[l,t]=e;return[a+l,r+t]}));break;case 3:for(let[o,d]of[[-1,-1],[1,1],[1,-1],[-1,1]])for(let[c,h]=[a+o,r+d];c>=0&&c<8&&h>=0&&h<8&&(s.push([c,h]),!e[8*c+h]);c+=o,h+=d);break;case 4:for(let[u,f]of[[-1,0],[1,0],[0,-1],[0,1]])for(let[x,m]=[a+u,r+f];x>=0&&x<8&&m>=0&&m<8&&(s.push([x,m]),!e[8*x+m]);x+=u,m+=f);break;case 5:for(let[p,b]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,1],[1,-1],[-1,1]])for(let[w,v]=[a+p,r+b];w>=0&&w<8&&v>=0&&v<8&&(s.push([w,v]),!e[8*w+v]);w+=p,v+=b);break;case 6:s.push(...[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(e=>{let[l,t]=e;return[a+l,r+t]})),i>=8?(!0===t.k&&s.push([0,6]),!0===t.q&&s.push([0,1])):(!0===t.K&&s.push([7,6]),!0===t.Q&&s.push([7,1]))}return s.filter(l=>{let[t,s]=l;return t>=0&&t<8&&s>=0&&s<8&&(0===e[8*t+s]||i<8&&e[8*t+s]>=8||i>=8&&e[8*t+s]<8)}).map(e=>{let[l,t]=e;return 8*l+t})}function N(e){let{children:l,className:t,onClose:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.twCascade)("absolute inset-0 bg-black bg-opacity-50","flex flex-col items-center justify-center"),children:(0,s.jsxs)("div",{className:(0,n.twCascade)("relative rounded-md bg-slate-100 text-black w-10/12 p-6","flex flex-col gap-4 items-start",t),children:[l,a&&(0,s.jsxs)("button",{className:"absolute top-2 right-2 h-3 w-3",onClick:a,title:"Close",children:[(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-black border-t-2 -rotate-45"}),(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-black border-t-2 rotate-45"})]})]})})}let y=new Map([[6,{src:"/_next/static/media/Chess_klt45.d44afabb.svg",height:45,width:45}],[5,{src:"/_next/static/media/Chess_qlt45.9302ef5e.svg",height:45,width:45}],[3,{src:"/_next/static/media/Chess_blt45.b5239580.svg",height:45,width:45}],[2,{src:"/_next/static/media/Chess_nlt45.4b8a5a97.svg",height:45,width:45}],[4,{src:"/_next/static/media/Chess_rlt45.0f643735.svg",height:45,width:45}],[1,{src:"/_next/static/media/Chess_plt45.c737daaf.svg",height:45,width:45}],[14,{src:"/_next/static/media/Chess_kdt45.450ddba8.svg",height:45,width:45}],[13,{src:"/_next/static/media/Chess_qdt45.07b03f89.svg",height:45,width:45}],[11,{src:"/_next/static/media/Chess_bdt45.31a33096.svg",height:45,width:45}],[10,{src:"/_next/static/media/Chess_ndt45.5c2f8fb5.svg",height:45,width:45}],[12,{src:"/_next/static/media/Chess_rdt45.803056f9.svg",height:45,width:45}],[9,{src:"/_next/static/media/Chess_pdt45.26191735.svg",height:45,width:45}]])}},function(e){e.O(0,[626,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);