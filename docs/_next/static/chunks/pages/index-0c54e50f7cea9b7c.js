(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(9262)}])},9262:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return x}});var s=l(5893),a=l(5675),n=l.n(a),r=l(7294),i=l(4089),c=l(1163),o=l(1752),d=l.n(o);let{publicRuntimeConfig:u}=d()(),h="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function x(){let e=(0,c.useRouter)(),{state:t}=e.query,l=(0,r.useMemo)(()=>{let e=[],l=t||[];for(let s=0;s<l.length;s+=2){let a=f.indexOf(l[s+0]),n=f.indexOf(l[s+1]);e.push([a,n])}return e},[t]),[a,n]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[x,v]=(0,r.useState)(!1),[y,C]=(0,r.useState)(null),[_,M]=(0,r.useState)(null),A=(0,r.useMemo)(()=>b(h).board,[h]),[q,D]=(0,r.useState)(null),{board:E,check:P,mate:S,lostPieces:O,castling:B}=(0,r.useMemo)(()=>{let e=[...A],t=[],s={K:!0,Q:!0,k:!0,q:!0},a=null;for(let[n,r]of l.concat(q?[q]:[]))e[r]&&t.push(e[r]),e[r]=e[n],e[n]=0,0===n?s.q=!1:4===n?(s.q=!1,s.k=!1):7===n?s.k=!1:56===n?s.Q=!1:60===n?(s.Q=!1,s.K=!1):63===n&&(s.K=!1),a=r;let i=null!==a&&N(e,a).map(t=>e[t]).includes(e[a]>=8?6:14),c=!1;if(i){let o=e.map((e,t)=>t).filter(t=>null!==a&&e[a]>=8?e[t]<8:e[t]>=8);for(let d of(c=!0,o)){let{possibleMoves:u}=j(e,d);if(u.length>0){c=!1;break}}}return{board:e,lostPieces:t,check:i,mate:c,castling:s}},[h,l,q]);(0,r.useEffect)(()=>void console.log(B),[B]);let K=l.length%2!=0,R=(0,r.useMemo)(()=>{if(null===q)return null;let e=l.concat([q||[]]).flat().map(e=>f[e]).join("");return"".concat(window.location.origin,"/?state=").concat(e)},[l,q,P]),{x0:Q,y0:F,dx:T,dy:H}=(0,r.useMemo)(()=>{if(!Array.isArray(q))return{};{let e=g(q[0],K),t=g(q[1],K),l=1+2*e[1],s=1+2*e[0],a=1+2*t[1],n=1+2*t[0],r=a-l,i=n-s,c=Math.sqrt(r*r+i*i);return{x0:l,y0:s,dx:r/c*(c-.71),dy:i/c*(c-.71)}}},[q]),[W,G]=(0,r.useState)(!1),X=(0,r.useRef)(null),{possibleMoves:I,forbiddenMoves:V}=(0,r.useMemo)(()=>j(E,y),[E,y]);return(0,s.jsxs)("div",{className:"w-full min-h-full flex flex-col items-center justify-center gap-4 md:py-4",children:[(0,s.jsxs)("h1",{className:"text-3xl font-black text-black dark:text-slate-300",children:["chess",(0,s.jsx)("span",{className:"text-slate-400 dark:text-slate-500",children:"by"}),"email",(0,s.jsx)("span",{className:"text-2xl",children:".com"})]}),(0,s.jsxs)("div",{className:"flex flex-col w-full md:w-auto gap-1",children:[(0,s.jsx)(m,{outerClassName:"md:px-8 w-full",aspect:"6.25%",children:O.filter(e=>K?e<8:e>=8).map((e,t)=>(0,s.jsx)(w,{className:"",piece:e},t))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-col gap-0",children:[(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-slate-500 font-bold",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"w-16 text-center rotate-180",children:"ABCDEFGH"[K?7-t:t]},t))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-row gap-0",children:[(0,s.jsx)("div",{className:"md:flex hidden flex-col h-full justify-center items-center w-6 text-slate-500 font-bold py-2",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"h-16 flex items-center",children:K?1+t:8-t},t))}),(0,s.jsx)("div",{className:"w-full md:w-auto border-slate-300 md:border-8 border-double border-y-8 box-content",children:(0,s.jsx)(m,{outerClassName:"md:w-128 w-full",aspect:"100%",children:(0,s.jsx)("div",{className:"flex flex-row md:h-auto md:w-auto h-full w-full",children:(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)("div",{className:"flex flex-col md:h-auto h-full",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"md:h-16 h-1/8 flex flex-row",children:Array(8).fill(0).map((e,l)=>[t^(K?7:0),l^(K?7:0),8*t+l^(K?63:0)]).map(e=>{let[t,a,n]=e;return(0,s.jsxs)("button",{disabled:!(null===y&&null===q&&0!==E[n]&&(K?E[n]>=8:E[n]<8)||null!==y&&null===q&&I.includes(n)||null!==y&&0!==E[n]&&(K?E[n]>=8:E[n]<8)||null===y&&null!==q&&n===q[0]),className:(0,i.twCascade)("h-full md:w-16 w-1/8 relative",{"bg-white dark:bg-slate-300":(t+a&1)==0,"bg-slate-300 dark:bg-slate-400":(t+a&1)==1}),onClick(e){if(null===q){v(!0);let t=E[n];y===n?C(null):0!=t&&(t>=8&&K||t<8&&!K)?C(n):null!==y&&I.includes(n)&&(d(!1),D([y,n]),C(null))}else n===q[0]&&(D(null),C(n))},onMouseOver:()=>void M(n),onMouseOut:()=>void M(null),children:[0!==E[n]&&(0,s.jsx)(p,{className:"h-full w-full",piece:E[n]}),I.includes(n)&&(0,s.jsx)("div",{className:"absolute h-[87.5%] w-[87.5%] border-dotted border-4 border-slate-500 dark:border-slate-800 rounded-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"},n),V.includes(n)&&(0,s.jsx)("div",{className:"absolute pointer-events-none -translate-x-1/2 -translate-y-1/2 text-4xl leading-none top-1/2 left-1/2",children:"\uD83D\uDFAC"}),(y===n||!x&&null===y&&null===q&&l.length>0&&l[l.length-1].includes(n)||(null==q?void 0:q.includes(n)))&&(0,s.jsx)("div",{className:"absolute pointer-events-none inset-0 border-solid md:border-4 border-[3px] border-slate-600 dark:border-slate-800"})]},a)})},t))}),P&&(0,s.jsx)("svg",{viewBox:"0 0 400 100",xmlns:"http://www.w3.org/2000/svg",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 md:h-32 h-28 pointer-events-none",children:(0,s.jsx)("text",{className:(0,i.twCascade)("text-4xl stroke-black fill-white font-black font-serif",{"fill-black stroke-white":l.length%2==(null===q?0:1)}),x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",strokeWidth:"3",paintOrder:"stroke",children:S?"CHECKMATE":"CHECK"})}),0===l.length&&!a&&(0,s.jsxs)(k,{onClose:()=>void n(!0),children:[(0,s.jsxs)("p",{children:["Welcome to ",(0,s.jsx)("i",{children:"chessbyemail"}),", a web app for playing correspondance chess."]}),(0,s.jsx)("p",{children:"When you've made your first move, a link is generated. You send this link to your opponent who continues the game."}),(0,s.jsx)("p",{children:"The state of the game is not stored on this server, it is encoded in the links you send when playing."}),(0,s.jsx)("div",{className:"self-center",children:(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void n(!0),children:"Start"})})]}),R&&!o&&(0,s.jsxs)(k,{className:"items-center",onClose:()=>void d(!0),children:[(0,s.jsx)("p",{className:"text-center",children:"Send the following link to your opponent"}),(0,s.jsx)("div",{className:"flex flex-row gap-4",children:(0,s.jsx)("input",{ref:X,style:{all:"revert"},type:"text",value:R,readOnly:!0,onFocus:e=>void e.target.select()})}),navigator&&(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[navigator.clipboard&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void navigator.clipboard.writeText(R),children:"Copy to clipboard"}),navigator.share&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void navigator.share({title:"chessbyemail.com",url:R}).then(()=>{}).catch(e=>void console.error(e)),children:"Share"})]})]})]})})})}),(0,s.jsx)("div",{className:"hidden md:flex flex-col h-full justify-center items-center w-6 text-slate-500 font-bold py-2",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"h-16 flex items-center rotate-180",children:K?1+t:8-t},t))})]}),(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-slate-500 font-bold",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"w-16 text-center",children:"ABCDEFGH"[K?7-t:t]},t))})]}),(0,s.jsx)(m,{outerClassName:"md:px-8 w-full",aspect:"6.25%",children:O.filter(e=>K?e>=8:e<8).map((e,t)=>(0,s.jsx)(w,{className:"",piece:e},t))})]}),(0,s.jsxs)("div",{className:"flex flex-row w-full justify-evenly text-xs opacity-50",children:[(0,s.jsx)("p",{children:"Copyright 2022, D. Revelj"}),(0,s.jsxs)("p",{children:["Version ",null==u?void 0:u.version]}),(0,s.jsx)("a",{className:"hover:underline",href:"https://github.com/chessbyemail/chessbyemail.github.io/issues",children:"Report an issue"})]})]})}function m(e){let{children:t,innerClassName:l,outerClassName:a,aspect:n}=e;return(0,s.jsx)("div",{className:(0,i.twCascade)("",a),children:(0,s.jsx)("div",{className:"h-0 relative w-full",style:{paddingBottom:n},children:(0,s.jsx)("div",{className:(0,i.twCascade)("absolute inset-0",l),children:t})})})}function p(e){let{className:t,piece:l}=e;return y.has(15&l)?(0,s.jsx)("div",{className:(0,i.twCascade)("relative w-full h-full",t),title:v.get(l),children:(0,s.jsx)(n(),{src:y.get(15&l),alt:v.get(l)||"",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-full"})}):(0,s.jsx)(s.Fragment,{})}function w(e){let{className:t,piece:l}=e;return(0,s.jsx)(m,{outerClassName:"w-1/16",aspect:"100%",children:(0,s.jsx)(n(),{src:y.get(15&l),alt:v.get(l)||"",className:"h-full"})})}let b=e=>{let t=new Map([["p",9],["n",10],["b",11],["r",12],["q",13],["k",14],["P",1],["N",2],["B",3],["R",4],["Q",5],["K",6]]),l=[];for(let s of e)l.length<64&&(t.has(s)?l.push(t.get(s)):/^[0-9]$/.test(s)&&l.push(...Array(parseInt(s)).fill(0)));return{board:l}},v=new Map([[0,""],[1,"white pawn"],[2,"white knight"],[3,"white bishop"],[4,"white rook"],[5,"white queen"],[6,"white king"],[9,"black pawn"],[10,"black knight"],[11,"black bishop"],[12,"black rook"],[13,"black queen"],[14,"black king"]]);function g(e,t){let l=Math.floor(e/8),s=e%8;return t&&(l=7-l,s=7-s),[l,s]}function j(e,t){if(null===t||0===e[t])return{forbiddenMoves:[],possibleMoves:[]};let l=N(e,t),s=e[t]>=8,a=e.map((e,t)=>[e,t]).filter(e=>{let[t,l]=e;return t&&(s?t<8:t>=8)}),n=[];for(let r of l){let i=[...e];i[r]=i[t],i[t]=0;let c=i.indexOf((s?8:0)+6);for(let[o,d]of a){let u=N(i,d);u.includes(c)&&n.push(r)}}return{forbiddenMoves:n,possibleMoves:l.filter(e=>!n.includes(e))}}function N(e,t){if(null===t)return[];let l=[],[s,a]=[Math.floor(t/8),t%8],n=e[t],r=n>=8?1:-1;switch(7&n){case 1:0===e[(s+r)*8+a]&&(l.push([s+r,a]),(n<8&&6===s||n>=8&&1===s)&&0===e[(s+2*r)*8+a]&&l.push([s+2*r,a])),e[(s+r)*8+a-1]&&l.push([s+r,a-1]),e[(s+r)*8+a+1]&&l.push([s+r,a+1]);break;case 2:l.push(...[[-2,-1],[-2,1],[2,-1],[2,1],[-1,2],[1,2],[-1,-2],[-1,2]].map(e=>{let[t,l]=e;return[s+t,a+l]}));break;case 3:for(let[i,c]of[[-1,-1],[1,1],[1,-1],[-1,1]])for(let[o,d]=[s+i,a+c];o>=0&&o<8&&d>=0&&d<8&&(l.push([o,d]),!e[8*o+d]);o+=i,d+=c);break;case 4:for(let[u,h]of[[-1,0],[1,0],[0,-1],[0,1]])for(let[f,x]=[s+u,a+h];f>=0&&f<8&&x>=0&&x<8&&(l.push([f,x]),!e[8*f+x]);f+=u,x+=h);break;case 5:for(let[m,p]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,1],[1,-1],[-1,1]])for(let[w,b]=[s+m,a+p];w>=0&&w<8&&b>=0&&b<8&&(l.push([w,b]),!e[8*w+b]);w+=m,b+=p);break;case 6:l.push(...[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(e=>{let[t,l]=e;return[s+t,a+l]}))}return l.filter(t=>{let[l,s]=t;return l>=0&&l<8&&s>=0&&s<8&&(0===e[8*l+s]||n<8&&e[8*l+s]>=8||n>=8&&e[8*l+s]<8)}).map(e=>{let[t,l]=e;return 8*t+l})}function k(e){let{children:t,className:l,onClose:a,...n}=e;return(0,s.jsx)("div",{className:(0,i.twCascade)("absolute inset-0 bg-black bg-opacity-50","flex flex-col items-center justify-center"),children:(0,s.jsxs)("div",{className:(0,i.twCascade)("relative rounded-md bg-slate-100 text-black w-10/12 p-6","flex flex-col gap-4 items-start",l),children:[t,a&&(0,s.jsx)("button",{className:"absolute top-1 right-2",onClick:a,children:"\uD83D\uDDD9"})]})})}let y=new Map([[6,{src:"/_next/static/media/Chess_klt45.d44afabb.svg",height:45,width:45}],[5,{src:"/_next/static/media/Chess_qlt45.9302ef5e.svg",height:45,width:45}],[3,{src:"/_next/static/media/Chess_blt45.b5239580.svg",height:45,width:45}],[2,{src:"/_next/static/media/Chess_nlt45.4b8a5a97.svg",height:45,width:45}],[4,{src:"/_next/static/media/Chess_rlt45.0f643735.svg",height:45,width:45}],[1,{src:"/_next/static/media/Chess_plt45.c737daaf.svg",height:45,width:45}],[14,{src:"/_next/static/media/Chess_kdt45.450ddba8.svg",height:45,width:45}],[13,{src:"/_next/static/media/Chess_qdt45.07b03f89.svg",height:45,width:45}],[11,{src:"/_next/static/media/Chess_bdt45.31a33096.svg",height:45,width:45}],[10,{src:"/_next/static/media/Chess_ndt45.5c2f8fb5.svg",height:45,width:45}],[12,{src:"/_next/static/media/Chess_rdt45.803056f9.svg",height:45,width:45}],[9,{src:"/_next/static/media/Chess_pdt45.26191735.svg",height:45,width:45}]])}},function(e){e.O(0,[626,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);